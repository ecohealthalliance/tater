template(name="annotations")
  if currentUser
    .document-detail-container
      .document-list-heading.pane-head.pane-head-l
        h2 Documents
        .actions
          button.btn-plain.select-all(disabled="{{allSelected}}")
            i.fa.fa-eye
            span Select all
          button.btn-plain.clear-filters(class="{{selectionState 'class'}}" disabled="{{selectionState 'disabled'}}")
            i.fa.fa-times-circle
            span Clear selection

      .document-list-container.pane.pane-l
        if Template.subscriptionsReady
          if isAdmin
            ul.all-docs-list.list-unstyled
              each groups
                li.group-selector-wrap
                  .group-selector(data-group=_id class="{{toggleEnabled}}")
                    i.down
                    span(class="{{selectedGroup}}")=name
                  ul.group-docs.list-unstyled.hidden
                    each groupDocuments
                      li.document-selector(data-id=_id class="{{selectedDoc}}")
                        span.doc-title #{title}
          else
            ul.group-docs-list.list-unstyled
              each documents
                li.document-selector(data-id=_id class="{{selectedDoc}}")
                  span.doc-title #{title}
                  if isAdmin
                    span.doc-group=docGroup
        else
          .loading

      .annotation-list-heading.pane-head.pane-head-m
        h1 Annotations
        .pull-right
          .show-flagged.pull-left
            input(type="checkbox", checked=showFlagged)
            | View Flagged
            i.fa.fa-flag-o
          if showingAnnotations
            a.btn.btn-default.btn-sm.download-csv.pull-left
              i.fa.fa-download
              span Generate CSV
      .annotations-list-container.pane.pane-m
        +pages
        +pagesNav
        unless documentSelected
          p.text-center Select a group or document to view annotations
      +annotationsCodingKeywords(
        selectedCodes=selectedCodes
        selectedHeaders=selectedHeaders
        selectedSubHeaders=selectedSubHeaders
        keywordQuery=keywordQuery
      )
  else
    .container.space-top-2
      p Please log in or sign up to continue.

  #download-csv-modal.modal.fade(tabindex="-1" role="dialog")
    .modal-dialog
      .modal-content
        .modal-header
          button(type="button" class="close" data-dismiss="modal" aria-label="Close")
            i.fa.fa-times-circle
        .modal-body
          if csvDataUri
            .row
              .col-sm-6.col-sm-offset-3
                a.btn.btn-primary.btn-lg.btn-block.download-csv-btn(href=csvDataUri download="annotations.csv") Download CSV
          else
            .loading.top
              h4 Generating CSV file

template(name="annotation")
  .annotation-group(class="color-#{codeColor}")
    h3
      span.icon.fa(class=icon)
      | #{codeString}
    ul.list-unstyled
      li.annotation-detail(data-annotation-id=_id, data-doc-id= documentId)
        p= annotatedText
        .details.clearfix
          span.document-title= documentTitle
          spna.user-email= user
