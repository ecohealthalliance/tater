template(name="documentDetail")
  if document
    if mechanicalTurkPreview
      +mTurkPreview
    else
      +finishAnnotationModal document=document
      +createMTurkJobModal document=document
      +documentNoteModal document=document
      .document-detail-container
        +documentDetailCodingKeywords
        .document-heading.pane-head.pane-head-m
          h1.document-title
            if document.finishedAt
              i.fa.fa-check-circle
            | #{document.title}
          .document-options
            unless onBSVEInstance
              if crowdsourceDoc document
                a.crowdsource-btn(data-toggle="modal" data-document-id=document._id data-target="#create-mturk-job-modal" )
                  +tooltipIcon icon='users' placement='bottom' title='Crowdsource Annotation'
                  
              unless document.finishedAt
                a.finished-btn(data-toggle="modal" data-target="#finish-annotation-modal" )
                  +tooltipIcon icon='check-circle' placement='bottom' title='Mark document as finished'
                  
              if mTurkAnnotating
                a.finished-annotating
                  i.fa.fa-check-circle.icon-left
                  span Finish Annotating
                  
              unless document.note
                a(data-toggle="modal" data-state='add' data-target="#document-note-modal")
                  +tooltipIcon icon='sticky-note' placement='bottom' title='Add Note'
              
            a.help-link.help-link-document.pull-right(href="{{path route='/help?topic=annotating-documents'}}")
              +tooltipIcon icon='question-circle' placement='bottom'
              
        .document-container.pane.pane-middle
          if document.mTurkEnabled
            if isAdmin
              .crowdsource-details
                  .admin-details
                    i.fa.fa-cogs
                    p Document has been submitted for annotation and is being processed.
                    a.btn.btn-default.btn-sm#cancel-mturk-job Cancel
            else if currentUser
              .crowdsource-details
                .user-details
                  i.fa.fa-exclamation-triangle
                  p This document has been crowdsourced and does not require annotation.
          #documentContainer
            #documentBody.document-body
              .document-wrapper
                .document-text
                  p= document.body
                if Template.subscriptionsReady
                  each annotationLayers
                    .document-annotations= this
        .annotation-search-container.pane-head.pane-head-r
          if Template.subscriptionsReady
            input#annotation-search-field.annotation-search.form-control(type="text" placeholder="Search Annotations")
            if searching
              i.fa.fa-times-circle.clear-search
        .annotation-container.pane.pane-r
          ul.annotations.list-unstyled
            if Template.subscriptionsReady
              each annotations
                +documentDetailAnnotation
              else
                if searching
                  .no-results
                    p Sorry, no annotations found.
                else
                  .no-results
                    p No annotations currently present.
            else
              .loading

template(name="documentDetailAnnotation")
  li(data-annotation-id=_id class="annotation-color-#{color} {{selected}}")
    if hitId
      span.code
        span.header= header
    else
      span.code= code
      if flagged
        span.toggle-flag.flagged.fa.fa-flag
      else
        span.toggle-flag.fa.fa-flag-o
    span.user= annotationUser
    .delete-annotation.btn-delete
      i.fa.fa-trash
