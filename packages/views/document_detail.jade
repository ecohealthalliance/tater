template(name="documentDetail")
  if document
    .document-detail-container
      +documentDetailCodingKeywords
      .document-heading.pane-head.pane-head-m
        h1.document-title= document.title
        .document-options
          if isAdmin
            unless mTurkEnabled document
              a.btn.btn-primary.crowdsource-btn(data-toggle="modal" data-document-id=document._id data-target="#create-mturk-job-modal" )
                i.fa.fa-users
                | Crowdsource
          a.help-link.help-link-document.pull-right(href="{{path route='/help?topic=annotating-documents'}}")
            +tooltipIcon icon='question-circle' placement='left'
          if accessCode
            button.finished-annotating.btn.btn-primary(data-toggle="modal" data-target="#completionCodeModal")
              i.fa.fa-check-circle.icon-left
              span Finished Annotating
      .document-container.pane.pane-middle
        if mTurkEnabled document
          .crowdsource-details
            if isAdmin
              .admin-details
                i.fa.fa-cogs
                p Document has been submitted for annotation and is being processed.
            else
              .user-details
                i.fa.fa-exclamation-triangle
                p This document has been crowdsourced and does not require annotation.
        #documentContainer
          #documentBody.document-body
            .document-wrapper
              pre.document-text= document.body
              if Template.subscriptionsReady
                each annotationLayers
                  .document-annotations
                    pre.document-text= this
      .annotation-search-container.pane-head.pane-head-r
        if Template.subscriptionsReady
          input#annotation-search-field.annotation-search.form-control(type="text" placeholder="Search Annotations")
          if searching
            i.fa.fa-times-circle.clear-search
      .annotation-container.pane.pane-r
        ul.annotations.list-unstyled
          if Template.subscriptionsReady
            each annotations
              +documentDetailAnnotation
            else
              if searching
                .no-results
                  i.fa.fa-search
                  p Sorry, no annotations found.
              else
                .no-results
                  p No annotations currently present.
          else
            .loading

  #completionCodeModal.modal.fade
    .modal-dialog
      .modal-content
        .modal-body
          p.instructions Thanks for completing this HIT.  Please enter this code into Mechanical Turk.
          h5.completion-code Code:
            span {{accessCode}}
  +createMTurkJobModal document=document

template(name="documentDetailAnnotation")
  li(data-annotation-id=_id class="annotation-color-#{color} {{selected}}")
    if accessCode
      span.code
        span.header= header
    else
      span.code= code
      if flagged
        span.toggle-flag.flagged.fa.fa-flag
      else
        span.toggle-flag.fa.fa-flag-o
    span.user= annotationUserEmail
    .delete-annotation.btn-delete
      i.fa.fa-trash
